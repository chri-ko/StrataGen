/*! For license information please see stratagen.js.LICENSE.txt */
(()=>{var e={660:(e,t,r)=>{var n;!function(e){!function(t){var n="object"==typeof r.g?r.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=o(e);function o(e,t){return function(r,n){"function"!=typeof e[r]&&Object.defineProperty(e,r,{configurable:!0,writable:!0,value:n}),t&&t(r,n)}}void 0===n.Reflect?n.Reflect=e:i=o(n.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,n=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,s=!o&&!a,c={create:o?function(){return D(Object.create(null))}:a?function(){return D({__proto__:null})}:function(){return D({})},has:s?function(e,r){return t.call(e,r)}:function(e,t){return t in e},get:s?function(e,r){return t.call(e,r)?e[r]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,f=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],r=function(){function e(e,t,r){this._index=0,this._keys=e,this._values=t,this._selector=r}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var r=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var r=this._find(e,!0);return this._values[r]=t,this},t.prototype.delete=function(t){var r=this._find(t,!1);if(r>=0){for(var n=this._keys.length,i=r+1;i<n;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new r(this._keys,this._values,n)},t.prototype.values=function(){return new r(this._keys,this._values,o)},t.prototype.entries=function(){return new r(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function n(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}():Map,h=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new f}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,p=new(l||"function"!=typeof WeakMap?function(){var e=c.create(),r=n();return function(){function e(){this._key=n()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=n()},e}();function n(){var t;do{t="@@WeakMap@@"+a()}while(c.has(e,t));return e[t]=!0,t}function i(e,n){if(!t.call(e,r)){if(!n)return;Object.defineProperty(e,r,{value:c.create()})}return e[r]}function o(e,t){for(var r=0;r<t;++r)e[r]=255*Math.random()|0;return e}function a(){var e,t=(e=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):o(new Uint8Array(e),e):o(new Array(e),e));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var r="",n=0;n<16;++n){var i=t[n];4!==n&&6!==n&&8!==n||(r+="-"),i<16&&(r+="0"),r+=i.toString(16).toLowerCase()}return r}}():WeakMap);function d(e,t,r){var n=p.get(e);if(S(n)){if(!r)return;n=new f,p.set(e,n)}var i=n.get(t);if(S(i)){if(!r)return;i=new f,n.set(t,i)}return i}function y(e,t,r){if(v(e,t,r))return!0;var n=$(t);return!x(n)&&y(e,n,r)}function v(e,t,r){var n=d(t,r,!1);return!S(n)&&!!n.has(e)}function g(e,t,r){if(v(e,t,r))return _(e,t,r);var n=$(t);return x(n)?void 0:g(e,n,r)}function _(e,t,r){var n=d(t,r,!1);if(!S(n))return n.get(e)}function m(e,t,r,n){d(r,n,!0).set(e,t)}function w(e,t){var r=b(e,t),n=$(e);if(null===n)return r;var i=w(n,t);if(i.length<=0)return r;if(r.length<=0)return i;for(var o=new h,a=[],s=0,c=r;s<c.length;s++){var u=c[s];o.has(u)||(o.add(u),a.push(u))}for(var l=0,f=i;l<f.length;l++)u=f[l],o.has(u)||(o.add(u),a.push(u));return a}function b(e,t){var r=[],n=d(e,t,!1);if(S(n))return r;for(var o=function(e){var t=E(e,i);if(!R(t))throw new TypeError;var r=t.call(e);if(!O(r))throw new TypeError;return r}(n.keys()),a=0;;){var s=j(o);if(!s)return r.length=a,r;var c=s.value;try{r[a]=c}catch(e){try{A(o)}finally{throw e}}a++}}function T(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function S(e){return void 0===e}function x(e){return null===e}function O(e){return"object"==typeof e?null!==e:"function"==typeof e}function P(e,t){switch(T(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var r=3===t?"string":5===t?"number":"default",i=E(e,n);if(void 0!==i){var o=i.call(e,r);if(O(o))throw new TypeError;return o}return function(e,t){if("string"===t){var r=e.toString;if(R(r)&&!O(i=r.call(e)))return i;if(R(n=e.valueOf)&&!O(i=n.call(e)))return i}else{var n;if(R(n=e.valueOf)&&!O(i=n.call(e)))return i;var i,o=e.toString;if(R(o)&&!O(i=o.call(e)))return i}throw new TypeError}(e,"default"===r?"number":r)}function k(e){var t=P(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function M(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function R(e){return"function"==typeof e}function C(e){return"function"==typeof e}function E(e,t){var r=e[t];if(null!=r){if(!R(r))throw new TypeError;return r}}function j(e){var t=e.next();return!t.done&&t}function A(e){var t=e.return;t&&t.call(e)}function $(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===u)return t;if(t!==u)return t;var r=e.prototype,n=r&&Object.getPrototypeOf(r);if(null==n||n===Object.prototype)return t;var i=n.constructor;return"function"!=typeof i||i===e?t:i}function D(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,r,n){if(S(r)){if(!M(e))throw new TypeError;if(!C(t))throw new TypeError;return function(e,t){for(var r=e.length-1;r>=0;--r){var n=(0,e[r])(t);if(!S(n)&&!x(n)){if(!C(n))throw new TypeError;t=n}}return t}(e,t)}if(!M(e))throw new TypeError;if(!O(t))throw new TypeError;if(!O(n)&&!S(n)&&!x(n))throw new TypeError;return x(n)&&(n=void 0),function(e,t,r,n){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,r,n);if(!S(o)&&!x(o)){if(!O(o))throw new TypeError;n=o}}return n}(e,t,r=k(r),n)})),e("metadata",(function(e,t){return function(r,n){if(!O(r))throw new TypeError;if(!S(n)&&!function(e){switch(T(e)){case 3:case 4:return!0;default:return!1}}(n))throw new TypeError;m(e,t,r,n)}})),e("defineMetadata",(function(e,t,r,n){if(!O(r))throw new TypeError;return S(n)||(n=k(n)),m(e,t,r,n)})),e("hasMetadata",(function(e,t,r){if(!O(t))throw new TypeError;return S(r)||(r=k(r)),y(e,t,r)})),e("hasOwnMetadata",(function(e,t,r){if(!O(t))throw new TypeError;return S(r)||(r=k(r)),v(e,t,r)})),e("getMetadata",(function(e,t,r){if(!O(t))throw new TypeError;return S(r)||(r=k(r)),g(e,t,r)})),e("getOwnMetadata",(function(e,t,r){if(!O(t))throw new TypeError;return S(r)||(r=k(r)),_(e,t,r)})),e("getMetadataKeys",(function(e,t){if(!O(e))throw new TypeError;return S(t)||(t=k(t)),w(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!O(e))throw new TypeError;return S(t)||(t=k(t)),b(e,t)})),e("deleteMetadata",(function(e,t,r){if(!O(t))throw new TypeError;S(r)||(r=k(r));var n=d(t,r,!1);if(S(n))return!1;if(!n.delete(e))return!1;if(n.size>0)return!0;var i=p.get(t);return i.delete(r),i.size>0||p.delete(t),!0}))}(i)}()}(n||(n={}))},590:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=t.deserialize=t.Serializable=t.JsonProperty=void 0,r(660);var o,a="api:map:",s=a+"serializable",c="design:type";function u(e){var t=Reflect.getPrototypeOf(e);return t&&t.name?i(u(t),[t.name]):[]}function l(e,t){var r={};return e.forEach((function(e){r=n(n({},r),Reflect.getMetadata(""+a+e,t))})),r}function f(e){return Reflect.hasOwnMetadata(s,e)}function h(e,t,r,n){if(null==e)return t;if(e=e.toLowerCase(),(typeof t).toLowerCase()===e)return t;var i=function(){console.error("Type '"+typeof t+"' is not assignable to type '"+e+"' for property '"+r+"' in '"+n+"'.\n","Received: "+JSON.stringify(t))};switch(e){case o.String:var a=t.toString();return"[object Object]"===a?void i():a;case o.Number:var s=+t;return isNaN(s)?void i():s;case o.Boolean:return void i();case o.Date:return isNaN(Date.parse(t))?void i():new Date(t);default:return t}}!function(e){e.Array="array",e.Boolean="boolean",e.Date="date",e.Number="number",e.Object="object",e.String="string"}(o||(o={})),t.JsonProperty=function(e){return function(t,r,i){if(void 0===r&&t.prototype){var s=Reflect.getMetadata("design:paramtypes",t)[i],u=function(e){var t=e.toString().replace(/(\/\*[\s\S]*?\*\/|\/\/.*$)/gm,"").replace(/[\r\t\n\v\f]/g,"").replace(/( +)/g," "),r=/(?:this\.)([^\n\r\t\f\v;]+)([\s;])/gm,n=new Map,i=/(?:.*(?:constructor|function).*?(?=\())(?:\()(.+?(?=\)))/m.exec(t);if(!i||!i.length)return n;for(var o,a=i[1].replace(/ /g,"").split(","),s=function(){var e=o[1].replace(/ /g,"").split("="),t=a.findIndex((function(t){return t===e[1]}));t>-1&&n.set(t,e[0])};o=r.exec(t);)s();return n}(t.prototype.constructor);r=u.get(i),t=t.prototype,Reflect.defineMetadata(c,s,t,r)}var l={},f=t.constructor.name,h=""+a+f;Reflect.hasMetadata(h,t)&&(l=Reflect.getMetadata(h,t)),l[r]=function(e,t){return t?(r=typeof t===o.String?{name:t,isNameOverridden:!0}:t.name?{name:t.name,isNameOverridden:!0}:t.names&&t.names.length?{names:t.names}:{name:e.toString(),isNameOverridden:!1},t.predicate?n(n({},r),{predicate:t.predicate,onDeserialize:t.onDeserialize,onSerialize:t.onSerialize,postDeserialize:t.postDeserialize,isDictionary:!!t.isDictionary}):n(n({},r),{type:t.type,onDeserialize:t.onDeserialize,onSerialize:t.onSerialize,postDeserialize:t.postDeserialize,isDictionary:!!t.isDictionary})):{name:e.toString(),isDictionary:!1,isNameOverridden:!1};var r}(r,e),Reflect.defineMetadata(h,l,t)}},t.Serializable=function(e){return function(t){var r=u(t);Reflect.defineMetadata(s,{baseClassNames:r,options:e},t)}},t.deserialize=function e(t,r){var i;if([null,void 0].includes(t))return t;if(void 0===r)return h(typeof t,t);var u=new r,p=u.constructor.name,d=null!==(i=Reflect.getMetadata(s,r))&&void 0!==i?i:{},y=d.baseClassNames,v=d.options,g=""+a+p,_=Reflect.hasMetadata(g,u),m={};return _||y&&y.length?(m=Reflect.getMetadata(g,u),y&&y.length&&(m=n(n({},l(y,u)),m)),Object.keys(m).forEach((function(r){var n=function(t,r,n,i,a){var s;if([null,void 0].includes(i))return i;if("names"in n){var u={};n.names.forEach((function(e){return u[e]=i[e]})),s=u}else if("name"in n&&!n.isNameOverridden&&a){var l=a(n.name);s=i[l]}else s=i[n.name];if([null,void 0].includes(s))return s;var p,d=Reflect.getMetadata(c,t,r),y=!!d.name&&d.name.toLowerCase()===o.Array,v=n.isDictionary,g=n.predicate,_=n.onDeserialize,m=n.postDeserialize,w=n.type||d,b=f(w);if(_&&(s=_(s,t)),v){var T={};typeof s!==o.Object?(console.error("Type '"+typeof s+"' is not assignable to type 'Dictionary' for property '"+r+"' in '"+t.constructor.name+"'.\n","Received: "+JSON.stringify(s)),p=void 0):(Object.keys(s).forEach((function(n){b||g?(g&&(w=g(s[n])),T[n]=e(s[n],w)):T[n]=h(typeof s[n],s[n],r,t.constructor.name)})),p=T)}else if(y){var S=[];Array.isArray(s)?(s.forEach((function(n){b||g?(g&&(w=g(n)),S.push(e(n,w))):S.push(h(typeof n,n,r,t.constructor.name))})),p=S):(console.error("Type '"+typeof s+"' is not assignable to type 'Array' for property '"+r+"' in '"+t.constructor.name+"'.\n","Received: "+JSON.stringify(s)),p=void 0)}else b||g?(w=g?g(s):w,p=e(s,w)):p=h(w.name,s,r,t.constructor.name);return m&&(p=m(p,t)),p}(u,r,m[r],t,null==v?void 0:v.formatPropertyNames);void 0!==n&&(u[r]=n)})),u):u},t.serialize=function e(t,r){var i;if(void 0===r&&(r=!0),[void 0,null].includes(t)||typeof t!==o.Object)return t;var u=t.constructor.name,h=""+a+u,p=null!==(i=Reflect.getMetadata(s,t.constructor))&&void 0!==i?i:{},d=p.baseClassNames,y=p.options,v=d&&d.length,g=Reflect.hasMetadata(h,t),_={};if(!g&&!v)return t;_=Reflect.getMetadata(h,t),v&&(_=n(n({},l(d,t)),_));var m={},w=Object.keys(t);return Object.keys(_).forEach((function(n){var i=_[n].onSerialize;if(w.includes(n)){var a=_[n],s=function(t,r,n,i){var a=t[r],s=Reflect.getMetadata(c,t,r),u=!!s.name&&s.name.toLocaleLowerCase()===o.Array,l=n.predicate,h=n.type||s,p=f(h);if(a&&(p||l)){if(u){var d=[];return a.forEach((function(t){d.push(e(t,i))})),d}if(n.isDictionary){var y={};return Object.keys(a).forEach((function(t){y[t]=e(a[t],i)})),y}return e(a,i)}return h.name.toLocaleLowerCase()===o.Date&&a?a.toISOString():a}(t,n,a,r);if(i&&(s=i(s,t)),a.names)a.names.forEach((function(e){(!r||r&&void 0!==s[e])&&(m[e]=s[e])}));else if(!r||r&&void 0!==s)if(!a.isNameOverridden&&(null==y?void 0:y.formatPropertyNames)){var u=y.formatPropertyNames(a.name);m[u]=s}else m[a.name]=s}})),m}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";var e,t,n,i=r(590),o=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};function s(e,t,r,i,o,a,s){if(e&&t.length){e.textBaseline="top";let c=e.measureText(t);const u=c.width,l=c.actualBoundingBoxDescent-c.actualBoundingBoxAscent;s==n.Center?e.fillText(t,r+Math.max((o-u)/2,0),i+(a-l)/2,o):s==n.Left?e.fillText(t,r,i+(a-l)/2,o):s==n.Right&&e.fillText(t,r+o-u,i+(a-l)/2,o)}}function c(e,t,r,i,o,a){let s=i;if(e&&t.length){let i=[],c=[];e.textBaseline="top";let u=0;const l=e.measureText(" ").width,f=e.measureText(t),h=1.5*(f.actualBoundingBoxDescent-f.actualBoundingBoxAscent);t.split(" ").forEach((function(t){const r=e.measureText(t);u+r.width>o&&(i.push(c.join(" ")),c.length=0,u=0),u+=r.width+l,c.push(t)})),c.length>0&&i.push(c.join(" "));for(let t of i){const i=e.measureText(t).width;a==n.Center?e.fillText(t,r+Math.max((o-i)/2,0),s,o):a==n.Left?e.fillText(t,r,s,o):a==n.Right&&e.fillText(t,r+o-i,s,o),s+=h}}return s}!function(e){e.Stratagem="Stratagem",e.PsychicPower="Psychic Power",e.TacticalObjective="Tactical Objective",e.Prayer="Prayer"}(t||(t={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center"}(n||(n={}));let u=e=class{constructor(){this._width=e.defaultWidthPx,this._height=e.defaultHeightPx,this._scale=1,this._type=t.Stratagem,this._heading="Stratagem",this._title="<Title>",this._fluff="<Fluff text>",this._rule="<Rule text>",this._value="1"}headerFont(){return Math.round(24*this._scale).toString()+"px Teko"}titleFont(){return Math.round(28*this._scale).toString()+"px Teko"}fluffFont(){return"italic "+Math.round(14*this._scale).toString()+"px serif"}ruleFont(){return Math.round(14*this._scale).toString()+"px serif"}footFont(){return Math.round(18*this._scale).toString()+"px Teko"}valueFont(){return Math.round(24*this._scale).toString()+"px Teko"}draw(r,i){let o=r.getContext("2d");if(!o)return;this._width=r.width-2*i,this._height=r.height-2*i,this._scale=Math.max(this._width/e.defaultWidthPx,this._height/e.defaultHeightPx),o.clearRect(0,0,r.width,r.height),o.translate(i,i),o.lineJoin="round",o.strokeStyle="silver",this.roundRect(o,1,1,this._width-2,this._height-2,20,!1,!0);const a=.05*this._width,u=a,l=this._width-2*a,f=this._height-2*u,h=Math.ceil(.3*a),p=this._height/12;o.save(),o.strokeStyle="grey",o.lineWidth=h,this.drawBorder(o,a,u,l,f,p),o.restore();const d=this._heading.toLocaleUpperCase();o.save(),o.font=this.headerFont(),o.textBaseline="top",o.fillStyle="black",s(o,d,a,u,l,p,n.Center),o.restore();let y=2*u+p;const v=2*a,g=this._width-2*a,_=g-v;o.moveTo(v,y),o.lineTo(g,y),o.stroke();const m=this._title.toLocaleUpperCase();if(o.save(),o.font=this.titleFont(),o.textBaseline="top",o.fillStyle="black",s(o,m,v,y,_,p,n.Center),o.restore(),y+=p,o.moveTo(v,y),o.lineTo(g,y),o.stroke(),y+=u,this._fluff.length>0&&(o.save(),o.font=this.fluffFont(),o.fillStyle="black",y=c(o,this._fluff,v,y,_,n.Center),o.restore(),y+=p/2),o.moveTo(v,y),o.lineTo(g,y),o.stroke(),y+=p/2,o.save(),o.font=this.ruleFont(),o.fillStyle="black",y=c(o,this._rule,v,y,_,n.Center),o.restore(),y=this._height-1.5*u-p,this._type==t.Stratagem||this._type==t.PsychicPower||this._type==t.TacticalObjective){const e=p;o.save(),o.lineWidth=Math.max(Math.ceil(this._scale),1),this.roundRect(o,2*v+e,y,_-2*v-e,p-6,8,!1,!0),o.restore(),o.save(),o.font=this.footFont(),o.textBaseline="top",o.fillStyle="black";let r="COMMAND POINTS";this._type===t.Stratagem?r="COMMAND POINTS":this._type===t.PsychicPower?r="WARP CHARGE":this._type===t.TacticalObjective&&(r="OBJECTIVE"),s(o,r,2*v+e,y,_-2*v-e,p-6,n.Center),o.restore(),o.save(),o.fillStyle="#ba2222",o.lineWidth=Math.max(Math.ceil(this._scale),1),this.bevelRect(o,2*v,y-3,e,e,5,!0,!0),o.restore(),o.save(),o.font=this.valueFont(),o.textBaseline="top",o.fillStyle="#f5f2f2",s(o,this._value,2*v,y-3,e,e,n.Center),o.restore()}else this._type,t.Prayer}toString(){return"Card: "+this._type.toString()+"  Title: "+this._title+"  Rule: "+this._rule+"  CP: "+this._value}roundRect(e,t,r,n,i,o,a,s){e.beginPath(),e.moveTo(t+o,r),e.lineTo(t+n-o,r),e.quadraticCurveTo(t+n,r,t+n,r+o),e.lineTo(t+n,r+i-o),e.quadraticCurveTo(t+n,r+i,t+n-o,r+i),e.lineTo(t+o,r+i),e.quadraticCurveTo(t,r+i,t,r+i-o),e.lineTo(t,r+o),e.quadraticCurveTo(t,r,t+o,r),e.closePath(),a&&e.fill(),s&&e.stroke()}bevelRect(e,t,r,n,i,o,a,s){e.beginPath(),e.moveTo(t,r+o),e.lineTo(t,r+i-o),e.lineTo(t+o,r+i),e.lineTo(t+n-o,r+i),e.lineTo(t+n,r+i-o),e.lineTo(t+n,r+o),e.lineTo(t+n-o,r),e.lineTo(t+o,r),e.closePath(),a&&e.fill(),s&&e.stroke()}drawBorder(e,t,r,n,i,o){this.bevelRect(e,t,r,n,i,o,!1,!0),e.moveTo(t,r+o),e.lineTo(t+n,r+o),e.stroke()}};u.defaultWidthPx=400,u.defaultHeightPx=560,o([(0,i.JsonProperty)(),a("design:type",Number)],u.prototype,"_width",void 0),o([(0,i.JsonProperty)(),a("design:type",Number)],u.prototype,"_height",void 0),o([(0,i.JsonProperty)(),a("design:type",Number)],u.prototype,"_scale",void 0),o([(0,i.JsonProperty)(),a("design:type",String)],u.prototype,"_type",void 0),o([(0,i.JsonProperty)(),a("design:type",String)],u.prototype,"_heading",void 0),o([(0,i.JsonProperty)(),a("design:type",String)],u.prototype,"_title",void 0),o([(0,i.JsonProperty)(),a("design:type",String)],u.prototype,"_fluff",void 0),o([(0,i.JsonProperty)(),a("design:type",String)],u.prototype,"_rule",void 0),o([(0,i.JsonProperty)(),a("design:type",String)],u.prototype,"_value",void 0),u=e=o([(0,i.Serializable)()],u);let l=[],f=0;function h(){let e=document.getElementById("preview");e&&l[f]&&l[f].draw(e,0)}function p(e){return e/25.4}function d(e){const t=e.split(".");return t.length>1?t[t.length-1].toLowerCase():""}function y(){l[f]&&($("#cardtype").val(l[f]._type.toString()),$("#cardheader").val(l[f]._heading),$("#cardtitle").val(l[f]._title),$("#cardrule").val(l[f]._rule),$("#cardfluff").val(l[f]._fluff),l[f]._type===t.Stratagem?($("#cardvalue").attr({min:1,max:3}),parseInt(l[f]._value)>3?l[f]._value="3":parseInt(l[f]._value)<1&&(l[f]._value="1"),$("#cardvaluelabel").html("Command Points"),$("#cardvaluecontrol").show()):l[f]._type===t.PsychicPower?($("#cardvalue").attr({min:2,max:12}),parseInt(l[f]._value)>12?l[f]._value="12":parseInt(l[f]._value)<2&&(l[f]._value="2"),$("#cardvaluelabel").html("Warp Charge"),$("#cardvaluecontrol").show()):l[f]._type===t.TacticalObjective?($("#cardvalue").attr({min:11,max:66}),parseInt(l[f]._value)>66?l[f]._value="66":parseInt(l[f]._value)<11&&(l[f]._value="11"),$("#cardvaluelabel").html("Objective (D66)"),$("#cardvaluecontrol").show()):l[f]._type===t.Prayer&&$("#cardvaluecontrol").hide(),$("#cardvalue").val(l[f]._value))}console.log("Reloading web page.");let v=document.getElementById("preview");v&&v.getContext("2d")&&0==l.length&&(f=0,l[f]=new u),$("#previouscard").click((function(){f=Math.max(f-1,0),y(),h()})),$("#nextcard").click((function(){f=Math.min(f+1,l.length-1),y(),h()})),$("#cardtype").on("change",(function(e){const r=e.target;r&&l[f]&&(l[f]._heading=r.selectedOptions[0].text,$("#cardheader").val(l[f]._heading),"Stratagem"==r.selectedOptions[0].text?l[f]._type=t.Stratagem:"Psychic Power"==r.selectedOptions[0].text?l[f]._type=t.PsychicPower:"Tactical Objective"==r.selectedOptions[0].text?l[f]._type=t.TacticalObjective:"Prayer"==r.selectedOptions[0].text&&(l[f]._type=t.Prayer),y(),h())})),$("#cardstyle").on("change",(function(e){e.target&&l[f]})),$("#cardheader").on("input",(function(e){const t=e.target;t&&l[f]&&(l[f]._heading=t.value,h())})),$("#cardtitle").on("input",(function(e){const t=e.target;t&&l[f]&&(l[f]._title=t.value,h())})),$("#cardrule").on("input",(function(e){const t=e.target;t&&l[f]&&(l[f]._rule=t.value,h())})),$("#cardfluff").on("input",(function(e){const t=e.target;t&&l[f]&&(l[f]._fluff=t.value,h())})),$("#cardvalue").on("input",(function(e){const t=e.target;t&&l[f]&&(l[f]._value=t.value,h())})),$("#createcard").click((function(){if(l[f]){const e=[63,88];let t=300,r=0;const n=document.getElementById("outputdpi");n&&(t=parseInt(n.value));const i=document.getElementById("outputmargin");i&&(r=parseInt(i.value));let o=Math.ceil(p(r)*t),a=document.createElement("canvas");a.width=Math.round(p(e[0])*t)+2*o,a.height=Math.round(p(e[1])*t)+2*o,l[f].draw(a,o);let s=document.createElement("a");s.download="stratagem.png",s.href=a.toDataURL("image/png"),s.click(),console.log("Current card: "+f+" Num active cards: "+l.length),y(),h()}})),$("#datacardfile").on("change",(function(e){const r=e.target.files;if(r){f=0,l.length=0;for(let e of r){const r=d(e.name);if("csv"===r||"tsv"===r){const n=new FileReader;n.onload=function(e){const n=e.target;if(n&&n.result){let e=n.result;const i=e.toString().indexOf(",")+1,o=window.atob(e.toString().slice(i)).split(/\r?\n/g);let a=t.Stratagem;for(let e of o){const n=e.split("csv"===r?",":"\t");if(n.length>1)if(console.log("Type: "+n[0]),"STRATAGEM"==n[0].toUpperCase()?a=t.Stratagem:"PSYCHIC POWER"===n[0].toUpperCase()?a=t.PsychicPower:"TACTICAL OBJECTIVE"===n[0].toUpperCase()?a=t.TacticalObjective:"PRAYER"===n[0].toUpperCase()?a=t.Prayer:($("#errorText").html("Unknown card type: "+n[0]+".  Supported card types are STRATAGEM, PSYCHIC POWER, PRAYER and TACTICAL OBJECTIVE."),$("#errorDialog").modal()),a==t.Prayer){if(5==n.length){let e=new u;e._type=a,e._value="",e._title=n[1],e._heading=n[2],e._fluff=n[3],e._rule=n[4],l.push(e)}}else if(6==n.length){let e=new u;e._type=a,e._value=n[1],e._title=n[2],e._heading=n[3],e._fluff=n[4],e._rule=n[5],l.push(e)}}f=0,console.log("Num active cards: "+l.length),y(),h()}},n.readAsDataURL(e)}else $("#errorText").html("StrataGen only supports .csv files.  Selected file is a '"+r+"' file."),$("#errorDialog").modal()}}})),$("#backgroundfile").on("change",(function(e){const t=e.target.files;t&&t[0]})),$("#bgopacity").on("input",(function(e){const t=e.target;t&&t.value})),$("#bgsaturation").on("input",(function(e){const t=e.target;t&&t.value})),$("#savecard").click((function(){localStorage.setItem("lastCard",JSON.stringify((0,i.serialize)(l[f])))})),$("#loadcard").click((function(){let e=localStorage.getItem("lastCard");e?(l[f]=(0,i.deserialize)(JSON.parse(e),u),y(),h()):console.log("Card not loaded.")})),h()})()})();